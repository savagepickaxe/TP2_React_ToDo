# TP2 - Application de gestion de tâches (TODO) - Refonte en React
**582-504-SF – Programmation spécialisée - Automne 2025**
Cégep de Sainte-Foy
**Enseignant :** Honoré Hounwanou

><span style="color: red">Il se peut que la description du TP2 présentée ci-dessous manque de précision sur certains aspects. Si c'est le cas, il est de votre responsabilité de le remarquer et de demander l'information qui manque.</span>

## Objectifs d'apprentissage

Dans ce travail pratique, vous allez transformer votre application TODO du TP1 en utilisant **React** et **Tanstack Router**. Vous apprendrez à :

- Structurer une application React avec des composants réutilisables
- Utiliser les hooks React (`useState`, `useEffect`, etc)
- Implémenter le routage multi-pages avec **Tanstack Router**
- Gérer l'état global d'une application React
- Communiquer avec une API REST via `fetch()` en React
- Intégrer Chart.js dans React avec [**react-chartjs-2**](https://github.com/reactchartjs/react-chartjs-2)
- Maintenir la cohérence visuelle entre le TP1 et le TP2
- Déployer une application React sur Vercel et intégrer une API distante

---

## Organisation du travail en équipe

Nous vous suggérons de travailler en **équipe de deux**, car c'est un objectif de votre formation, et vous pourrez ainsi vous partager la charge de travail. Chaque coéquipier doit contribuer à parts égales au développement de ce travail. Laisser son coéquipier faire tout le travail (peu importe les raisons) est inacceptable : vous passerez à côté des objectifs de ce cours. De la même manière, il ne faut pas non plus trop en faire : il faut apprendre à travailler en équipe!

Notez que l'historique des dépôts GitHub permet de voir quel membre de l'équipe est responsable de chacun des *commits*.

---

## Présentation individuelle en classe

Il est de votre responsabilité de prévoir du temps pendant les périodes de laboratoire du TP2 pour réaliser la présentation individuelle en
classe.

---

## Description du projet

Vous devez recréer l'application du TP1 en utilisant **React** à la place du JavaScript pur. L'application comportera **plusieurs pages** (routes), mais le **rendu visuel final doit être identique** à celui du TP1.

**Fonctionnalités identiques au TP1 :**
1. **Afficher** toutes les tâches
2. **Ajouter** une nouvelle tâche
3. **Modifier** une tâche existante (nom, date, statut)
4. **Supprimer** une tâche
5. **Marquer** une tâche comme complétée/non complétée
6. **Visualiser** un graphique montrant les statistiques des tâches

**Nouveautés par rapport au TP1 :**
- Architecture basée sur React et ses composants
- Utilisation de **Tanstack Router** pour naviguer entre différentes pages
- Séparation des responsabilités : page de liste, page de statistiques, etc.
- Gestion d'état avec hooks React

---

## Installation et configuration

### Étape 1 : Créer le dossier racine

Créez un dossier nommé `tp2-todo/` dans votre répertoire de travail, puis à l'intérieur de ce dossier, ajoutez un sous-dossier `api/`. Placez ensuite le fichier fourni `tasks.php` dans ce sous-dossier.

**Arborescence attendue :**
```
tp2-todo/
├── api/
└──  └── tasks.php
```

### Étape 2 : Créer le projet React

Commencez par vous placer dans le dossier `tp2-todo/` précédemment créé :

```bash
cd tp2-todo/
```

Exécutez ensuite les commandes suivantes afin d'utiliser Vite pour initialiser rapidement un projet React :

```bash
npm create vite@latest frontend -- --template react
# Use rolldown-vite: No
# Install with npm and start now? (No)
cd frontend/
npm install
```

### Étape 2 : Installer les dépendances

Installez les packages nécessaires :

```bash
cd frontend/ # si ce n'est pas déjà fait
npm install @tanstack/react-router
npm install -D @tanstack/react-devtools @tanstack/react-router-devtools
npm install -D @tanstack/router-plugin
npm install react-chartjs-2 chart.js
```

### Étape 3: Configurer Vite

Modifiez `vite.config.js` :

```js
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import { tanstackRouter } from '@tanstack/router-plugin/vite'
import { fileURLToPath, URL } from 'node:url'

export default defineConfig({
  plugins: [
    tanstackRouter({
      target: 'react',
      autoCodeSplitting: true,
    }),
    react(),
  ],
  resolve: {
    alias: {
      '@': fileURLToPath(new URL('./src', import.meta.url)),
    },
  },
})
```

### Étape 4 : Configurer App.jsx

Modifiez `src/App.jsx` :

```jsx
import { createRouter, RouterProvider } from '@tanstack/react-router';
import { routeTree } from './routeTree.gen';

const router = createRouter({ routeTree });

function App() {
  return <RouterProvider router={router} />;
}

export default App;
```

### Étape 5 : Petit nettoyage

1. Supprimez les fichiers suivants :
    - `public/vite.svg`
    - `src/assets/react.svg`
    - `src/App.css`
2. Comme les dossiers `public/` et `src/assets/` seront désormais vides, ajoutez-y un fichier nommé `.gitkeep`. Cela permettra de conserver ces dossiers dans le dépôt, car Git n'enregistre pas les dossiers vides.

### Étape 6 : Structure du projet

Organisez votre projet de la manière suivante :

```
tp2-todo/
├── api/
│   └── tasks.php (fourni identique au TP1)
├── frontend/
│   ├── public/
│   │   └── .gitkeep
│   ├── src/
│   │   ├── assets/
│   │   │   └── .gitkeep
│   │   ├── components/
│   │   │   └── [...vos composants React]
│   │   ├── hooks/
│   │   │   └── useTasks.js
│   │   ├── routes/
│   │   │   ├── __root.jsx
│   │   │   ├── index.jsx
│   │   │   └── [...autres pages]
│   │   ├── App.jsx
│   │   ├── index.css
│   │   └── main.jsx
│   ├── .gitignore
│   ├── eslint.config.js
│   ├── index.html
│   ├── package.json
│   ├── README.md
└── └── vite.config.js
```

### Étape 6 : Serveur PHP

Lancez un serveur PHP local ou utilisez MAMP/XAMPP :

```bash
cd tp2-todo/api/
php -S localhost:8000
```

### Étape 7 : Serveur Vite

```bash
cd tp2-todo/frontend/
npm run dev
```

---

## Documentation de l'API

L'API reste **identique au TP1**. Consultez le fichier `api/tasks.php` pour les endpoints :

- `GET /api/tasks.php` - Récupérer toutes les tâches
- `GET /api/tasks.php?id=1` - Récupérer une tâche spécifique
- `POST /api/tasks.php` - Créer une tâche
- `PUT /api/tasks.php?id=1` - Modifier une tâche
- `DELETE /api/tasks.php?id=1` - Supprimer une tâche

---

## Travail à réaliser

### ÉTAPE 1 : Réfléchir à l'architecture des composants

Avant de coder, posez-vous les bonnes questions pour identifier vos composants React.

#### Questions de réflexion

Répondez à ces questions pour identifier les composants dont vous avez besoin :

**1. Composition et structure**
- Quelle est la plus petite unité réutilisable ? Est-ce une tâche individuelle ? Un bouton ? Une entrée de formulaire ?
- Quels éléments se répètent dans votre interface ? (ex: chaque tâche, chaque statistique)

**2. Responsabilité unique**
- Qu'est-ce qu'un composant **doit faire** vs ce qu'il **ne doit pas faire** ?
- Exemple : `TaskList` doit afficher l'ensemble des tâches, mais doit-il gérer l'ajout/modification/suppression d'une tâche ou déléguer cette responsabilité à un autre composant ?

**3. Flux de données**
- Quel composant doit **posséder l'état** des tâches (le state) ?
- Comment les enfants communiquent-ils avec le parent pour demander une action ? (props callbacks)
- Est-ce qu'un composant enfant doit modifier directement le state ou demander au parent ?

**4. Pages et routage**
- Combien de pages / routes devez-vous avoir dans votre application ?
- Exemple: une page pour la liste des tâches, une page pour les statistiques, une page d'accueil ?
- Comment l'utilisateur navigue entre ces pages ?

**5. État et ses variants**
- Quels états différents peut avoir une tâche ? (complétée, non complétée, en édition, en suppression)
- Quel composant doit connaître ces états ?
- Comment communiquer ces changements d'état ?

#### Livrables attendus pour cette étape

Créez un fichier `ARCHITECTURE.md` dans votre projet et documentez :

```markdown
# Architecture des composants

## Composants identifiés

### 1. Composant TaskList
- **Responsabilité** : Afficher la liste des tâches
- **Props** : tasks, onToggle, onEdit, onDelete
- **État local** : none

### 2. Composant TaskItem
- **Responsabilité** : Afficher une tâche individuelle
- **Props** : task, onToggle, onEdit, onDelete
- **État local** : none (ou si édition inline, l'état d'édition)

### [Continuez avec vos autres composants...]

## Flux de données

[Expliquez comment les données circulent entre les composants]

## Routes / Pages

- `/` - Page d'accueil avec liste des tâches
- `/stats` - Page de statistiques
- [Autres routes...]
```

---

### ÉTAPE 2 : Créer les composants React

En vous basant sur votre réflexion de l'étape 1, créez vos différents composants.

#### 2.1 : Hook personnalisé `useTasks`

Créez un hook réutilisable pour gérer les tâches :

```jsx
// frontend/src/hooks/useTasks.js

export function useTasks() {
    const [tasks, setTasks] = React.useState([]);
    const [loading, setLoading] = React.useState(true);
    const [error, setError] = React.useState(null);

    // Charger toutes les tâches
    const loadTasks = React.useCallback(async () => {
        try {
            setLoading(true);
            // TODO: Appeler l'API pour récupérer les tâches
            // TODO: Mettre à jour le state tasks
        } catch (err) {
            // TODO: Gérer l'erreur
        } finally {
            setLoading(false);
        }
    }, []);

    // Ajouter une tâche
    const addTask = React.useCallback(async (title, dueDate) => {
        // TODO: Valider les données
        // TODO: Appeler l'API POST
        // TODO: Rafraîchir la liste
    }, []);

    // Modifier le statut d'une tâche
    const toggleTask = React.useCallback(async (taskId) => {
        // TODO: Trouver la tâche actuelle
        // TODO: Appeler l'API PUT avec le nouveau statut
        // TODO: Mettre à jour le state
    }, [tasks]);

    // Modifier une tâche
    const editTask = React.useCallback(async (taskId, title, dueDate) => {
        // TODO: Appeler l'API PUT
        // TODO: Mettre à jour le state
    }, []);

    // Supprimer une tâche
    const deleteTask = React.useCallback(async (taskId) => {
        // TODO: Demander confirmation
        // TODO: Appeler l'API DELETE
        // TODO: Mettre à jour le state
    }, []);

    React.useEffect(() => {
        loadTasks();
    }, [loadTasks]);

    return { tasks, loading, error, loadTasks, addTask, toggleTask, editTask, deleteTask };
}
```

---

### ÉTAPE 3 : Styliser l'application

#### Directives de style

Le **rendu visuel doit être identique** au TP1. Pour ce faire :

**3.1 Préparation du CSS**
- Copier le fichier `style.css` du TP1 dans `src/index.css`
- Vous pouvez conserver ce fichier global ou le décomposer en fichiers CSS par composant

**3.2 Structure CSS recommandée**
- Utilisez les classes BEM (Block Element Modifier) de manière cohérente
- Format : `.block__element--modifier`
- Exemple : `.task-item__checkbox--completed`, `.task-form__input--error`

**3.3 Organisation du CSS par composant** (optionnel mais recommandé)
- Créez un fichier CSS pour chaque composant : `TaskList.css`, `TaskItem.css`, etc.
- Importez le CSS au début du fichier du composant
- Conservez une structure claire pour la maintenance

**3.4 Vérification visuelle**
- Ouvrez le TP1 côte à côte avec votre TP2
- Comparez les couleurs, les espacements, les typographies
- Corrigez les écarts identifiés
- Testez sur différentes résolutions d'écran (desktop, tablette, mobile)

**3.5 Optimisation du CSS**
- Supprimez les styles non utilisés
- Regroupez les styles similaires
- Utilisez des variables CSS pour les couleurs et les espacements (optionnel)

#### Exemple : Variables CSS

```css
:root {
  --color-primary: #007bff;
  --color-danger: #dc3545;
  --color-success: #28a745;
  --spacing-unit: 8px;
  --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}
```

---

### ÉTAPE 4 : Tests et validation

Testez exhaustivement votre application :

#### Tests fonctionnels

- [ ] Les tâches s'affichent au chargement de la page
- [ ] Le graphique s'affiche correctement
- [ ] Ajouter une tâche fonctionne (avec et sans date)
- [ ] Modifier une tâche fonctionne (titre et/ou date)
- [ ] Basculer le statut d'une tâche fonctionne (checkbox)
- [ ] Supprimer une tâche fonctionne (avec confirmation)
- [ ] La validation du formulaire empêche d'ajouter une tâche sans titre

#### Tests de navigation (Tanstack Router)

- [ ] Navigation vers `/` affiche la liste
- [ ] Navigation vers `/stats` affiche les statistiques
- [ ] Les liens de navigation fonctionnent
- [ ] L'URL change lors de la navigation

#### Tests visuels

- [ ] Le rendu visuel est identique au TP1
- [ ] Les classes BEM sont utilisées correctement
- [ ] Les styles sont appliqués correctement
- [ ] L'application est responsive

---

### ÉTAPE 5 : Déploiement

Déployez votre application sur Vercel et configurez l'accès à l'API distante.

#### 5.1 Préparation du déploiement Vercel

**Créer un compte Vercel**
- Rendez-vous sur https://vercel.com
- Inscrivez-vous avec votre compte GitHub (recommandé)
- Autorisez Vercel à accéder à vos dépôts

**Préparer votre dépôt GitHub**
- Poussez votre projet complet frontend sur GitHub (sans le dossier `node_modules`)
- Assurez-vous que votre `.gitignore` contient :
  ```
  node_modules/
  dist/
  .env.local
  ```

#### 5.2 Configuration de l'API distante

**Variable d'environnement Vite**
- Créez un fichier `.env.production` à la racine du projet :
  ```
  VITE_API_URL=https://timunix3.csfoy.ca/~nomequipe
  ```
- Modifiez votre hook `useTasks.js` pour utiliser cette variable :
  ```javascript
  const API_URL = import.meta.env.VITE_API_URL || 'http://localhost:8000';
  
  const response = await fetch(`${API_URL}/tasks.php`);
  ```

**CORS et accès distant**
- L'API sur Timunix3 doit être accessible depuis Vercel
- Si des erreurs CORS surviennent, contactez l'enseignant
- Assurez-vous que les en-têtes appropriés sont configurés côté serveur PHP

#### 5.3 Déploiement sur Vercel

**Option 1 : Via l'interface web de Vercel** (recommandé)
1. Cliquez sur "Add New -> Project"
2. Sélectionnez votre dépôt GitHub
3. Vérifiez les paramètres :
   - **Framework** : Vite
   - **Root Directory** : ./
   - **Build Command** : `npm run build`
   - **Output Directory** : `dist`
4. Ajoutez les variables d'environnement dans "Environment Variables"
5. Cliquez sur "Deploy"

**Option 2 : Via la ligne de commande**
```bash
npm install -g vercel
vercel login
vercel
```

#### 5.4 Vérification du déploiement

- [ ] L'application s'ouvre à l'URL fournie par Vercel
- [ ] Les tâches se chargent correctement depuis l'API distante
- [ ] Toutes les opérations CRUD fonctionnent (créer, lire, modifier, supprimer)
- [ ] Les erreurs console sont absentes
- [ ] La performance est acceptable
- [ ] L'URL Vercel est mentionnée dans le `README.md`

#### 5.5 Dépannage courant

**Erreur : "Cannot GET /"**
- Vérifiez que votre `vite.config.js` est correctement configuré
- Assurez-vous que `npm run build` génère un dossier `dist/`

**Erreur : "Failed to fetch from API"**
- Vérifiez la variable `VITE_API_URL` dans les paramètres Vercel
- Testez l'URL de l'API directement dans le navigateur
- Vérifiez les erreurs CORS dans les outils de développement

**Performances lentes**
- Optimisez les images et assets
- Vérifiez la latence de l'API Backend

---

## Critères d'évaluation

| Critère | Points | Description |
|---------|--------|-------------|
| **Architecture et composants** | 25 | Composants bien structurés, responsabilités claires |
| **Hook useTasks** | 10 | Gestion d'état centralisée, appels API corrects |
| **Tanstack Router** | 10 | Routage fonctionnel, navigation correcte, pages bien organisées |
| **Chart.js et react-chartjs-2** | 10 | Graphique affiché, données correctes, mise à jour dynamique |
| **Visuel et style** | 10 | Rendu identique au TP1, BEM respecté, responsive |
| **Tests et validation** | 10 | Toutes les opérations fonctionnent correctement (CRUD), pas d'erreurs console |
| **Déploiement et intégration API distante** | 10 | Application déployée sur Vercel, API distante fonctionnelle, README mis à jour |
| **Présentation** | 10 | Présentation individuelle en classe |
| **Innovation** | 5 | Nouvelles fonctionnalités, améliorations UX (animations, transitions), innovations technologiques qui vont au-delà des exigences de base |

**Total : 100 points**

---

## Ressources et documentation

- **React** : https://react.dev/
- **React Hooks** : https://react.dev/reference/react/hooks
- **Tanstack Router** : https://tanstack.com/router/latest
- **react-chartjs-2** : https://react-chartjs-2.js.org/
- **Chart.js** : https://www.chartjs.org/
- **Fetch API** : https://developer.mozilla.org/fr/docs/Web/API/Fetch_API
- **Vercel Deployment** : https://vercel.com/docs
- **Vite Environment Variables** : https://vite.dev/guide/env-and-mode#env-variables-and-modes

---

## Questions fréquentes

**Q : Dois-je conserver le même style CSS que le TP1 ?**  
R : Pas nécessairement 1:1, mais le rendu visuel doit être similaire.

**Q : Comment gérer les erreurs d'API ?**  
R : Utilisez des blocs `try...catch` dans votre hook `useTasks` et stockez les erreurs dans le state.

**Q : Faut-il utiliser l'API Context, Redux ou Zustand pour gérer l'état ?**  
R : Non, un hook personnalisé suffit pour ce TP. Vous pouvez explorer l'API Context en bonus.

**Q : Comment gérer le chargement (loading) de l'API ?**  
R : Retournez un état `loading` du hook `useTasks` et affichez un message/spinner si `loading` est true.

**Q : Quel est l'URL de l'API distante ?**  
R : L'API sera hébergée sur votre dossier équipe Timunix3. L'URL exacte sera fournie par l'enseignant. Utilisez une variable d'environnement pour la configurer facilement.

**Q : Mon déploiement sur Vercel échoue, comment déboguer ?**  
R : Consultez les logs de build dans le dashboard Vercel. Vérifiez que tous les fichiers nécessaires sont commités dans Git et que les variables d'environnement sont correctement configurées.

---

## Remise

**Date de remise :** 12 décembre à minuit

**Format de remise :**
- Un fichier ZIP contenant :
  - Le dossier `api/` avec `tasks.php`
  - Le dossier `frontend/` (sans le dossier `node_modules`)
  - Un fichier `ARCHITECTURE.md` documentant vos composants
  - Un fichier `README.md` expliquant comment installer, lancer et accéder à votre application
  - Un fichier `.env.production` (optionnel, peut être configuré directement dans Vercel)

**Nommage du fichier :** `TP2_NomEquipe.zip`


**Contenu du README.md (minimum requis)**
```markdown
# TODO App - TP2 React

## Description
Application de gestion de tâches refondue en React avec routage multi-pages.

## Installation

### Prérequis
- Node.js 16+
- npm

### Étapes
1. Clonez le dépôt
3. Lancez le serveur API PHP : `cd api && php -S localhost:8000`
2. Installez les dépendances et lancez le serveur de développement : `cd frontend && npm install && npm run dev`

## Utilisation

- Accédez à http://localhost:5173
- Utilisez l'application pour gérer vos tâches

## Déploiement

L'application est déployée sur Vercel à l'adresse :  
**[Insérez votre URL Vercel ici]**

L'API distante est hébergée sur notre dossier équipe Timunix3:
**[Insérez votre URL ici]**

## Structure du projet

- `api/` : Backend PHP
- `frontend/` : Frontend React
    - `src/` : Code source React
        - `components/` : Composants réutilisables
        - `hooks/` : Hooks personnalisés
        - `routes/` : Pages et configuration routeur

## Technologies utilisées

- React 18
- Vite
- Tanstack Router
- Chart.js + react-chartjs-2
```

---

## Conseils et bonnes pratiques

### 1. Commencez par l'architecture (ÉTAPE 1)

Ne codez pas directement! Prenez du temps pour réfléchir à vos composants et documenter votre plan. Cela rendra le reste du travail beaucoup plus facile.

### 2. Testez au fur et à mesure

Ne laissez pas tous les tests à la fin. Après chaque fonctionnalité, testez-la dans le navigateur.

### 3. Utilisez les React DevTools

Installez l'extension React DevTools pour déboguer plus facilement :
https://react.dev/learn/react-developer-tools

### 4. Organisez vos fichiers

Gardez une structure du dossier `src/` claire :
- Composants dans `components/`
- Hooks dans `hooks/`
- Pages dans `routes/`
- Utilitaires dans `utils/`

### 5. Gestion d'erreurs

Toujours entourer les appels API d'un `try...catch` :

```javascript
try {
    const response = await fetch('api/tasks.php');
    if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
    }
    const data = await response.json();
    // Traiter les données
} catch (error) {
    console.error('Erreur:', error);
    setError(error.message);
}
```

### 6. Validation et confirmation

Avant de supprimer, demandez toujours confirmation :

```javascript
if (window.confirm('Êtes-vous sûr de vouloir supprimer cette tâche ?')) {
    await deleteTask(taskId);
}
```

### 7. Formatage de date

Créez une fonction utilitaire pour formater les dates :

```javascript
// src/utils/formatDate.js
/**
 * Formate une date en chaîne lisible en français
 * @param {string} dateString - Date au format YYYY-MM-DD
 * @returns {string} Date formatée
 */
export function formatDate(dateString) {
    if (!dateString) return '';
    
    const options = { 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
    };
    
    return new Date(dateString + 'T00:00:00').toLocaleDateString('fr-FR', options);
}
```

---

## Interdictions et conformité

### ⛔ Ce que vous ne devez PAS faire

1. **Génération de code complète par IA** : Vous ne devez pas demander à une IA de générer le code à votre place
2. **Plagiat** : Le code doit être le vôtre
3. **Oublier l'API fournie** : Vous devez utiliser l'API PHP fournie, ne pas créer votre propre backend
4. **Ignorer le TP1** : Le visuel doit rester similaire

### ✅ Ce que vous pouvez faire

1. **Clarifier des concepts** : Utiliser une IA pour comprendre React, les hooks, Tanstack Router
2. **Déboguer** : Demander de l'aide pour comprendre une erreur
3. **Apprendre** : Demander des explications sur la documentation
4. **Valider** : Demander si votre approche est correcte (avant de coder)

---

## En cas de problème

Si vous rencontrez des problèmes :

1. **Consultez la console** (F12) pour voir les erreurs
2. **Vérifiez l'onglet Réseau** pour voir les requêtes API
3. **Utilisez `console.log()`** pour déboguer votre state
4. **Posez des questions** aux heures de laboratoire ou par Teams

---

**Bon travail!**

Ce TP vous montrera que **le rendu final peut être identique, mais le code utilisé en coulisses peut être complètement différent**. C'est la magie d'une bonne architecture!
